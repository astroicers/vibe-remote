services:
  vibe-remote:
    build:
      context: .
      dockerfile: server/Dockerfile
    ports:
      - "8080:8080"
    volumes:
      # Mount workspace for Claude to access
      - ${WORKSPACE_HOST_PATH:-/home/ubuntu}:/workspace:rw
      # Persist database
      - vibe-data:/app/data
      # Mount Claude credentials
      - ${HOME}/.claude:/home/node/.claude:rw
    environment:
      - NODE_ENV=production
      - PORT=8080
      - HOST=0.0.0.0
      - JWT_SECRET=${JWT_SECRET:-}
      - CLAUDE_PERMISSION_MODE=bypassPermissions
      - DATABASE_PATH=./data/vibe-remote.db
      - CLAUDE_CODE_OAUTH_TOKEN=${CLAUDE_CODE_OAUTH_TOKEN}
      - WORKSPACE_HOST_PATH=${WORKSPACE_HOST_PATH:-/home/ubuntu}
      - WORKSPACE_CONTAINER_PATH=/workspace
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/api/health"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
    restart: unless-stopped

volumes:
  vibe-data:
