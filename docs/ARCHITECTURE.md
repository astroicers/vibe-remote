# Architecture â€” Vibe Remote

## ç³»çµ±å…¨æ™¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        æ‰‹æ©Ÿ (PWA)                             â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Chat UI  â”‚ â”‚Diff View â”‚ â”‚Task Queueâ”‚ â”‚ Quick Actions â”‚  â”‚
â”‚  â”‚+ Voice   â”‚ â”‚+ Approve â”‚ â”‚+ Kanban  â”‚ â”‚ commit/push/  â”‚  â”‚
â”‚  â”‚  Input   â”‚ â”‚ /Reject  â”‚ â”‚  Board   â”‚ â”‚  test/PR      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚       â”‚            â”‚            â”‚               â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Services Layer                            â”‚  â”‚
â”‚  â”‚  api.ts (REST fetch) + ws.ts (WebSocket auto-reconnect)â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ HTTPS + WSS
                   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
                   â”‚  Tailscale  â”‚  WireGuard encrypted tunnel
                   â”‚  100.x.y.z  â”‚  Zero-trust network
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Vibe Remote Server (ä½ çš„ Mac / VPS / NAS)        â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 API Gateway (Express.js)               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚  JWT    â”‚  â”‚   CORS   â”‚  â”‚   Rate Limiter    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚  Auth   â”‚  â”‚  Filter  â”‚  â”‚   (per-device)    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚          â”‚          â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  AI Engine  â”‚ â”‚ Workspace â”‚ â”‚ Task Runner  â”‚              â”‚
â”‚  â”‚             â”‚ â”‚  Manager  â”‚ â”‚              â”‚              â”‚
â”‚  â”‚ Claude API  â”‚ â”‚ Git Ops   â”‚ â”‚ Queue        â”‚              â”‚
â”‚  â”‚ Context     â”‚ â”‚ File Tree â”‚ â”‚ Executor     â”‚              â”‚
â”‚  â”‚ Builder     â”‚ â”‚ Watcher   â”‚ â”‚ Branch Mgmt  â”‚              â”‚
â”‚  â”‚ Tool        â”‚ â”‚ Search    â”‚ â”‚ Dependencies â”‚              â”‚
â”‚  â”‚ Executor    â”‚ â”‚           â”‚ â”‚              â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚              â”‚              â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚                   SQLite Database                    â”‚      â”‚
â”‚  â”‚  conversations â”‚ messages â”‚ tasks â”‚ workspaces       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 Workspaces (File System)               â”‚   â”‚
â”‚  â”‚  ~/projects/merak-platform/                           â”‚   â”‚
â”‚  â”‚  ~/projects/security-mcp-server/                      â”‚   â”‚
â”‚  â”‚  ~/projects/vibe-remote/                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒå…ƒä»¶

### 1. API Gateway

Express.js HTTP server + WebSocket server å…±äº«åŒä¸€å€‹ portã€‚

```
Port 3000:
  â”œâ”€â”€ GET/POST/PUT/DELETE /api/*    â†’ REST endpoints
  â”œâ”€â”€ WS /ws                        â†’ WebSocket (AI streaming, real-time updates)
  â””â”€â”€ GET /*                        â†’ Static files (React PWA)
```

**è¨­è¨ˆæ±ºç­–**ï¼š
- å–®ä¸€ port éƒ¨ç½²æœ€ç°¡å–®ï¼ŒTailscale åªéœ€é–‹ä¸€å€‹ port
- Express è€Œé Fastify/Koa â€” ç”Ÿæ…‹æœ€å¤§ï¼ŒClaude æœ€ç†Ÿæ‚‰ï¼Œé™¤éŒ¯æœ€å®¹æ˜“
- express-ws å¥—ä»¶è™•ç† WebSocketï¼Œä¸éœ€è¦ç¨ç«‹çš„ socket.io

### 2. AI Engine

è² è²¬èˆ‡ Claude API æºé€šï¼Œæ˜¯æ•´å€‹ç³»çµ±çš„æ ¸å¿ƒã€‚

```
AI Engine
â”œâ”€â”€ claude-client.ts      # Anthropic SDK wrapper
â”‚   â”œâ”€â”€ sendMessage()     # Streaming completion
â”‚   â”œâ”€â”€ handleToolUse()   # Tool call loop
â”‚   â””â”€â”€ cancelRequest()   # ä¸­æ–·æ­£åœ¨é€²è¡Œçš„è«‹æ±‚
â”‚
â”œâ”€â”€ context-builder.ts    # çµ„è£ AI context
â”‚   â”œâ”€â”€ getProjectContext()
â”‚   â”‚   â”œâ”€â”€ è®€ workspace çš„ file tree (filtered by .gitignore)
â”‚   â”‚   â”œâ”€â”€ è®€ git status + recent commits
â”‚   â”‚   â”œâ”€â”€ è®€ package.json / tsconfig.json (key config files)
â”‚   â”‚   â””â”€â”€ å¦‚æœ workspace æœ‰ system promptï¼ŒåŠ å…¥
â”‚   â”œâ”€â”€ getFileContext()
â”‚   â”‚   â””â”€â”€ ä½¿ç”¨è€…æ‰‹å‹•é¸æ“‡çš„ context files å…§å®¹
â”‚   â””â”€â”€ getConversationContext()
â”‚       â””â”€â”€ æœ€è¿‘ N è¼ªå°è©±æ­·å²
â”‚
â”œâ”€â”€ tool-executor.ts      # AI tool use åŸ·è¡Œå™¨
â”‚   â”œâ”€â”€ file_read         # è®€å–æª”æ¡ˆ
â”‚   â”œâ”€â”€ file_write        # å¯«å…¥/å»ºç«‹æª”æ¡ˆ
â”‚   â”œâ”€â”€ file_edit         # ç²¾ç¢ºç·¨è¼¯ï¼ˆsearch & replaceï¼‰
â”‚   â”œâ”€â”€ terminal_run      # åŸ·è¡Œçµ‚ç«¯æŒ‡ä»¤ï¼ˆæœ‰ç™½åå–®ï¼‰
â”‚   â”œâ”€â”€ search_codebase   # ripgrep æœå°‹
â”‚   â””â”€â”€ git_diff          # æŸ¥çœ‹ç•¶å‰ diff
â”‚
â””â”€â”€ prompt-templates.ts   # é å®šç¾© prompt ç¯„æœ¬ç®¡ç†
```

**AI äº’å‹•æµç¨‹ï¼ˆä¸€æ¬¡ chat messageï¼‰**ï¼š

```
1. User sends message (text or voice transcription)
2. context-builder çµ„è£ system prompt:
   â”œâ”€â”€ Base system prompt (ä½ æ˜¯ä¸€å€‹ coding assistant...)
   â”œâ”€â”€ Project context (file tree, git info)
   â”œâ”€â”€ User-selected file contents
   â””â”€â”€ Workspace system prompt (if any)
3. é™„ä¸Šå°è©±æ­·å² (æœ€è¿‘ 20 è¼ª)
4. å‘¼å« Claude API (streaming)
5. æ¯æ”¶åˆ°ä¸€å€‹ chunk â†’ WebSocket å³æ™‚é€åˆ° client
6. å¦‚æœ AI å›è¦†åŒ…å« tool_use:
   â”œâ”€â”€ tool-executor åŸ·è¡Œå°æ‡‰æ“ä½œ
   â”œâ”€â”€ å°‡ tool result é€å› Claude
   â””â”€â”€ é‡è¤‡æ­¥é©Ÿ 4-6 ç›´åˆ° AI ä¸å†å‘¼å« tool
7. AI å®Œæˆå›è¦† â†’ å­˜å…¥ SQLite
8. å¦‚æœæœ‰æª”æ¡ˆè¢«ä¿®æ”¹ â†’ è‡ªå‹•ç”¢ç”Ÿ diff â†’ æ¨é€ diff_ready event
```

### 3. Workspace Manager

ç®¡ç† server ä¸Šçš„æ‰€æœ‰å°ˆæ¡ˆç›®éŒ„ã€‚

```
Workspace Manager
â”œâ”€â”€ manager.ts          # CRUD æ“ä½œ
â”‚   â”œâ”€â”€ register()      # è¨»å†Šä¸€å€‹ç›®éŒ„ç‚º workspace
â”‚   â”œâ”€â”€ list()          # åˆ—å‡ºæ‰€æœ‰ workspaces
â”‚   â”œâ”€â”€ getStatus()     # å–å¾— git status æ‘˜è¦
â”‚   â””â”€â”€ setActive()     # åˆ‡æ›ç•¶å‰ active workspace
â”‚
â”œâ”€â”€ git-ops.ts          # Git æ“ä½œ (via simple-git)
â”‚   â”œâ”€â”€ status()        # branch + uncommitted changes
â”‚   â”œâ”€â”€ diff()          # staged + unstaged diff
â”‚   â”œâ”€â”€ commit()        # commit with message
â”‚   â”œâ”€â”€ push()          # push to remote
â”‚   â”œâ”€â”€ pull()          # pull from remote
â”‚   â”œâ”€â”€ checkout()      # switch/create branch
â”‚   â”œâ”€â”€ log()           # recent commits
â”‚   â””â”€â”€ createPR()      # GitHub API create PR
â”‚
â”œâ”€â”€ file-tree.ts        # æª”æ¡ˆçµæ§‹
â”‚   â”œâ”€â”€ getTree()       # éè¿´è®€å–ï¼Œrespect .gitignore
â”‚   â””â”€â”€ readFile()      # è®€å–å–®ä¸€æª”æ¡ˆ
â”‚
â”œâ”€â”€ file-watcher.ts     # chokidar ç›£è½
â”‚   â””â”€â”€ æª”æ¡ˆè®Šæ›´æ™‚ â†’ WebSocket é€šçŸ¥ client åˆ·æ–°
â”‚
â””â”€â”€ search.ts           # ripgrep wrapper
    â””â”€â”€ search()        # å…¨æ–‡æœå°‹ codebase
```

### 4. Task Runner (Phase 2)

éåŒæ­¥ä»»å‹™åŸ·è¡Œç³»çµ±ã€‚MVP å…ˆç”¨ in-memory queueï¼ŒPhase 2 æ¥ BullMQã€‚

```
Task Runner
â”œâ”€â”€ queue.ts            # ä»»å‹™ä½‡åˆ—ç®¡ç†
â”‚   â”œâ”€â”€ enqueue()       # åŠ å…¥ä»»å‹™
â”‚   â”œâ”€â”€ dequeue()       # å–å‡ºä¸‹ä¸€å€‹ä»»å‹™
â”‚   â”œâ”€â”€ getStatus()     # æŸ¥è©¢ä»»å‹™ç‹€æ…‹
â”‚   â””â”€â”€ cancel()        # å–æ¶ˆä»»å‹™
â”‚
â”œâ”€â”€ runner.ts           # ä»»å‹™åŸ·è¡Œå¼•æ“
â”‚   â”œâ”€â”€ å¾ queue å–å‡º task
â”‚   â”œâ”€â”€ å»ºç«‹ç¨ç«‹ branch
â”‚   â”œâ”€â”€ å•Ÿå‹• AI å°è©±å®Œæˆä»»å‹™
â”‚   â”œâ”€â”€ ç”¢ç”Ÿ diff
â”‚   â”œâ”€â”€ æ›´æ–°ç‹€æ…‹ç‚º awaiting_review
â”‚   â””â”€â”€ æ¨é€é€šçŸ¥
â”‚
â”œâ”€â”€ branch-manager.ts   # åˆ†æ”¯ç®¡ç†
â”‚   â”œâ”€â”€ create()        # vibe/task-{id}-{slug}
â”‚   â”œâ”€â”€ cleanup()       # åˆªé™¤å·² merge çš„åˆ†æ”¯
â”‚   â””â”€â”€ switch()        # åˆ‡æ›åˆ†æ”¯
â”‚
â””â”€â”€ dependency.ts       # ä¾è³´è§£æ
    â”œâ”€â”€ resolve()       # æ‹“æ’²æ’åº
    â””â”€â”€ canRun()        # æª¢æŸ¥å‰ç½®ä»»å‹™æ˜¯å¦å®Œæˆ
```

## è³‡æ–™æµ

### Chat Message Flow

```
â”Œâ”€â”€â”€â”€â”€â”  text/voice   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  REST POST   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Phoneâ”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ PWA UI  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Server  â”‚
â”‚     â”‚               â”‚         â”‚              â”‚          â”‚
â”‚     â”‚  WS: chunks   â”‚         â”‚  WS: stream  â”‚  Claude  â”‚
â”‚     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚         â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   API    â”‚
â”‚     â”‚               â”‚         â”‚              â”‚          â”‚
â”‚     â”‚  WS: diff     â”‚         â”‚  file change â”‚  Tool    â”‚
â”‚     â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚         â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ Executor â”‚
â””â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Diff Review Flow

```
AI ä¿®æ”¹æª”æ¡ˆ
    â”‚
    â–¼
git diff (unstaged changes)
    â”‚
    â–¼
Server è§£æ diff â†’ per-file breakdown
    â”‚
    â–¼
WebSocket push "diff_ready" â†’ Client
    â”‚
    â–¼
User reviews file-by-file
    â”‚
    â”œâ”€ âœ… Approve â†’ file æ¨™è¨˜ç‚º approved
    â”œâ”€ âŒ Reject  â†’ revert è©²æª”æ¡ˆçš„æ”¹å‹•
    â””â”€ ğŸ’¬ Comment â†’ é€å› AI â†’ AI é‡æ”¹ â†’ æ–° diff
    â”‚
    â–¼
All files approved?
    â”œâ”€ Yes â†’ å•Ÿç”¨ commit/push æŒ‰éˆ•
    â””â”€ No  â†’ ç¹¼çºŒ review
```

### Task Queue Flow (Phase 2)

```
User creates task(s)
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  queued   â”‚ â†’  â”‚ running â”‚ â†’  â”‚awaiting_reviewâ”‚ â†’  â”‚ approved â”‚
â”‚          â”‚    â”‚         â”‚    â”‚              â”‚    â”‚          â”‚
â”‚ ç­‰å¾…åŸ·è¡Œ  â”‚    â”‚ AI å·¥ä½œä¸­â”‚    â”‚ ç­‰å¾… user     â”‚    â”‚ å¯ commit â”‚
â”‚          â”‚    â”‚         â”‚    â”‚  review diff  â”‚    â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                                    â”‚
                     â–¼                                    â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ failed  â”‚                        â”‚committed â”‚
                â”‚         â”‚                        â”‚          â”‚
                â”‚ å¯é‡è©¦   â”‚                        â”‚ å·²å…¥ git  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## éƒ¨ç½²æ¶æ§‹

### æœ€ç°¡éƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰

```
ä½ çš„ Mac Mini / æ¡Œæ©Ÿ / VPS
â”œâ”€â”€ Tailscale (èƒŒæ™¯é‹è¡Œ)
â”œâ”€â”€ Vibe Remote Server (Node.js process)
â”‚   â”œâ”€â”€ port 3000: API + PWA static files
â”‚   â””â”€â”€ data/: SQLite DB files
â”œâ”€â”€ code-server (port 8080ï¼Œæ¡Œé¢ä½¿ç”¨)
â””â”€â”€ ~/projects/: ä½ çš„å°ˆæ¡ˆå€‘

æ‰‹æ©Ÿï¼š
â”œâ”€â”€ Tailscale App (èƒŒæ™¯é‹è¡Œ)
â””â”€â”€ Safari/Chrome â†’ https://100.x.y.z:3000 (PWA)
```

### Docker éƒ¨ç½²

```yaml
# docker-compose.yml
services:
  vibe-remote:
    build: .
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data               # SQLite æŒä¹…åŒ–
      - ~/projects:/workspaces:rw       # Mount ä½ çš„å°ˆæ¡ˆç›®éŒ„
      - ~/.ssh:/root/.ssh:ro            # Git SSH key
      - ~/.gitconfig:/root/.gitconfig:ro
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - JWT_SECRET=${JWT_SECRET}
```

### èˆ‡ code-server çš„å…±å­˜

```
åŒä¸€å° Server:
â”œâ”€â”€ port 3000: Vibe Remote (æ‰‹æ©Ÿç”¨)
â”œâ”€â”€ port 8080: code-server (é›»è…¦ç”¨)
â””â”€â”€ ~/projects/: å…±äº«çš„æª”æ¡ˆç³»çµ±

å…©è€…å®Œå…¨ç¨ç«‹é‹è¡Œï¼Œä½†æ“ä½œåŒä¸€å€‹ file systemã€‚
æ‰‹æ©Ÿä¸Š approve çš„æ”¹å‹•ï¼Œåœ¨é›»è…¦çš„ code-server ä¸Šå³æ™‚å¯è¦‹ã€‚
é›»è…¦ä¸Šçš„æ”¹å‹•ï¼Œæ‰‹æ©Ÿä¸Š pull-to-refresh ä¹Ÿç«‹å³çœ‹åˆ°ã€‚
åŒæ­¥æ©Ÿåˆ¶ = å…±äº« file system + gitï¼Œä¸éœ€è¦é¡å¤–çš„ sync layerã€‚
```

## æŠ€è¡“é¸å‹ç†ç”±

| é¸æ“‡ | æ›¿ä»£æ–¹æ¡ˆ | ç‚ºä»€éº¼é¸é€™å€‹ |
|-------|---------|-------------|
| Express.js | Fastify, Koa, Hono | ç”Ÿæ…‹æœ€å¤§ã€AI æœ€ç†Ÿæ‚‰ã€é™¤éŒ¯å®¹æ˜“ |
| SQLite | PostgreSQL, MongoDB | é›¶ç¶­è­·ã€å–®æª”å‚™ä»½ã€å€‹äººå·¥å…·å¤ ç”¨ |
| better-sqlite3 | sql.js, drizzle-orm | åŒæ­¥ API æœ€ç°¡å–®ã€æ•ˆèƒ½æœ€å¥½ |
| React | Vue, Svelte, Solid | ç”Ÿæ…‹æœ€å¤§ã€AI ç”¢å‡ºå“è³ªæœ€ç©©å®š |
| Tailwind CSS | CSS Modules, styled-components | å¿«é€Ÿè¿­ä»£ã€ä¸éœ€åˆ‡æª”æ¡ˆ |
| zustand | Redux, Jotai, MobX | æœ€è¼•é‡ã€boilerplate æœ€å°‘ |
| Vite | webpack, esbuild | é–‹ç™¼é«”é©—æœ€å¥½ã€è¨­å®šæœ€å°‘ |
| simple-git | nodegit, isomorphic-git | API æœ€ç›´è¦ºã€ç¶­è­·æœ€å¥½ |
| zod | joi, yup, io-ts | TypeScript åŸç”Ÿæ¨å°ã€æœ€æµè¡Œ |
| Web Speech API | Whisper, Deepgram | ç€è¦½å™¨åŸç”Ÿã€é›¶æˆæœ¬ã€é›¶å»¶é² |

## æ•ˆèƒ½è€ƒé‡

- **AI Response**ï¼šClaude API latency ç´„ 1-3 ç§’é¦–å€‹ tokenï¼Œstreaming é¿å…ä½¿ç”¨è€…ç­‰å¾…
- **SQLite**ï¼šå–®ä¸€å¯«å…¥è€…ï¼Œä¸éœ€è¦ WAL modeï¼ˆä½†å»ºè­°é–‹å•Ÿ `journal_mode=WAL` ä»¥å…è¨±è®€å¯«ä¸¦è¡Œï¼‰
- **File Tree**ï¼šå¤§å‹ monorepo å¯èƒ½æœ‰ä¸Šè¬æª”æ¡ˆï¼Œè¦è¨­å¥½ depth limit å’Œ ignore patterns
- **WebSocket**ï¼šå¿ƒè·³æ¯ 30 ç§’ï¼Œè‡ªå‹•é‡é€£ç­–ç•¥ï¼ˆ1s â†’ 2s â†’ 4s â†’ 8s â†’ 30s maxï¼‰
- **Push Notification**ï¼šéœ€è¦ VAPID key pairï¼Œserver ç«¯å„²å­˜ subscription
